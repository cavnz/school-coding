<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Student Showcase - Juicy Platformer</title>
  <link rel="stylesheet" href="style.css?v=1">
  <style>
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 30px;
      margin-top: 30px;
    }

    .project-card {
      background: white;
      border: 2px solid #e1e4e8;
      border-radius: 10px;
      overflow: hidden;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .project-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .project-preview {
      width: 100%;
      height: 200px;
      background: #34495e;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ecf0f1;
      font-size: 1.2em;
      position: relative;
      overflow: hidden;
      cursor: pointer;
      transition: filter 0.3s;
    }

    .project-preview:hover {
      filter: brightness(1.1);
    }

    .project-preview iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    /* Static preview styles */
    .static-preview {
      width: 100%;
      height: 100%;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .preview-scene {
      width: 100%;
      height: 100%;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .preview-player {
      width: 30px;
      height: 30px;
      border-radius: 4px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    .preview-platform {
      width: 120px;
      height: 15px;
      position: absolute;
      border-radius: 2px;
    }

    .preview-coin {
      width: 15px;
      height: 15px;
      border-radius: 50%;
      position: absolute;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .preview-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .project-preview:hover .preview-overlay {
      opacity: 1;
    }

    .preview-play-btn {
      background: white;
      color: #2c3e50;
      padding: 12px 24px;
      border-radius: 25px;
      font-weight: bold;
      font-size: 1.1em;
      pointer-events: none;
    }

    .project-info {
      padding: 20px;
    }

    .project-title {
      font-size: 1.3em;
      color: #2c3e50;
      margin-bottom: 10px;
    }

    .project-author {
      color: #7f8c8d;
      font-size: 0.9em;
      margin-bottom: 10px;
    }

    .project-description {
      color: #34495e;
      margin-bottom: 15px;
      font-size: 0.95em;
    }

    .project-links {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .project-link {
      display: inline-block;
      background: #3498db;
      color: white;
      padding: 8px 16px;
      border-radius: 5px;
      text-decoration: none;
      transition: background 0.3s;
      white-space: nowrap;
    }

    .project-link:hover {
      background: #2980b9;
      text-decoration: none;
    }

    .submit-section {
      background: #e8f4f8;
      padding: 30px;
      border-radius: 10px;
      margin-top: 40px;
      text-align: center;
    }

    .submit-form {
      max-width: 600px;
      margin: 20px auto;
      text-align: left;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      color: #2c3e50;
      font-weight: bold;
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 10px;
      border: 2px solid #bdc3c7;
      border-radius: 5px;
      font-family: 'Courier New', monospace;
      font-size: 1em;
    }

    .form-group textarea {
      resize: vertical;
      min-height: 80px;
    }

    .submit-btn {
      background: #2ecc71;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 5px;
      cursor: pointer;
      font-family: 'Courier New', monospace;
      font-size: 1.1em;
      transition: background 0.3s;
    }

    .submit-btn:hover {
      background: #27ae60;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #7f8c8d;
    }

    .empty-state h3 {
      font-size: 2em;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üåü Student Showcase</h1>
      <p class="subtitle">Amazing games to play or make more awesome!</p>
    </header>

    <main>
      <section>
        <a href="index.html">‚Üê Back to Instructions</a>

        <h2>Gallery</h2>

        <div id="gallery" class="gallery">
          <!-- Projects will be loaded here -->
          <div class="empty-state">
            <h3>üé®</h3>
            <p>No projects yet! Be the first to submit your creation.</p>
            <p>Once you've finished your game, scroll down to submit it!</p>
          </div>
        </div>
      </section>

      <section class="submit-section">
        <h2>Submit Your Game!</h2>
        <p>Finished your juicy platformer? Share it!</p>

        <div class="submit-form">
          <p><strong>How to submit:</strong></p>
          <ol>
            <li>Click "Save fiddle" in JSFiddle to save your version</li>
            <li>Copy your JSFiddle URL (e.g., https://jsfiddle.net/abc123/)</li>
            <li>Send it to me with:
              <ul>
                <li>Your name (or team name)</li>
                <li>Your JSFiddle URL</li>
                <li>A brief description of what makes your version special</li>
              </ul>
            </li>
            <li>I'll add it to the showcase with a link to edit!</li>
          </ol>

          <p style="margin-top: 20px;"><em>Your project will appear here alongside everyone else's creations!</em></p>
        </div>
      </section>

      <section>
        <h2>üí° Tips for Making Your Game Stand Out</h2>
        <ul>
          <li>Experiment with crazy physics (negative gravity, super speed!)</li>
          <li>Add tons of particles and screen shake for epic effects</li>
          <li>Try different colors and visual styles</li>
          <li>Create challenging platform layouts</li>
          <li>Combine multiple effects for coin collection</li>
          <li>Make the "all coins collected" celebration amazing!</li>
        </ul>
      </section>
    </main>

    <footer>
      <p>Keep experimenting and have fun! üöÄ</p>
    </footer>
  </div>

  <script src="showcase-data.js?v=1"></script>
  <script>
    // Load and display projects
    function loadProjects() {
      const gallery = document.getElementById('gallery');

      // Check if projects are available
      if (typeof projects === 'undefined' || projects.length === 0) {
        return; // Keep empty state
      }

      // Clear empty state
      gallery.innerHTML = '';

      // Create cards for each project
      projects.forEach(project => {
        const card = document.createElement('div');
        card.className = 'project-card';

        // Generate static preview or fallback
        let preview;
        const targetUrl = project.folder ? `${project.folder}/index.html` : project.jsfiddle;

        if (project.preview && targetUrl) {
          // Custom color preview (works for both folder and jsfiddle projects)
          preview = `
            <div class="project-preview" onclick="window.open('${targetUrl}', '_blank')">
              <div class="static-preview">
                <div class="preview-scene" style="background: ${project.preview.background};">
                  <!-- Platform at bottom -->
                  <div class="preview-platform" style="background: ${project.preview.platform}; bottom: 20%; left: 50%; transform: translateX(-50%);"></div>

                  <!-- Player in center -->
                  <div class="preview-player" style="background: ${project.preview.player}; top: 40%;"></div>

                  <!-- Coins scattered around -->
                  <div class="preview-coin" style="background: ${project.preview.accent}; top: 25%; left: 30%;"></div>
                  <div class="preview-coin" style="background: ${project.preview.accent}; top: 35%; left: 65%;"></div>
                  <div class="preview-coin" style="background: ${project.preview.accent}; top: 65%; left: 40%;"></div>
                </div>
              </div>
              <div class="preview-overlay">
                <div class="preview-play-btn">‚ñ∂ Click to ${project.folder ? 'Play' : 'Open JSFiddle'}</div>
              </div>
            </div>
          `;
        } else if (targetUrl) {
          // Generic preview for projects without custom colors
          preview = `
            <div class="project-preview" onclick="window.open('${targetUrl}', '_blank')">
              <div class="preview-overlay" style="opacity: 1; background: rgba(52, 73, 94, 0.95);">
                <div class="preview-play-btn">‚ñ∂ ${project.folder ? 'Click to Play' : 'Open on JSFiddle'}</div>
              </div>
            </div>
          `;
        } else {
          preview = `<div class="project-preview">Preview Coming Soon</div>`;
        }

        // Play/View link
        let playLink = '';
        if (project.folder) {
          playLink = `<a href="${project.folder}/index.html" target="_blank" class="project-link">Play Full Screen ‚Üí</a>`;
        } else if (project.jsfiddle) {
          playLink = `<a href="${project.jsfiddle}" target="_blank" class="project-link">View on JSFiddle ‚Üí</a>`;
        }

        // Edit link - always prefer local folder if it exists
        let editLink = '';
        if (project.folder) {
          // Has local folder - use it to open in JSFiddle
          editLink = `<button onclick="openProjectInJSFiddle('${project.folder}')" class="project-link" style="background: #f39c12; border: none; cursor: pointer; font-family: inherit; font-size: inherit;">üöÄ Edit on JSFiddle ‚Üí</button>`;
        } else if (project.jsfiddle) {
          // JSFiddle-only - link directly to it
          editLink = `<a href="${project.jsfiddle}" target="_blank" class="project-link" style="background: #f39c12;">üöÄ Edit on JSFiddle ‚Üí</a>`;
        }

        card.innerHTML = `
          ${preview}
          <div class="project-info">
            <div class="project-title">${escapeHtml(project.title)}</div>
            <div class="project-author">by ${escapeHtml(project.author)}</div>
            <div class="project-description">${escapeHtml(project.description)}</div>
            <div class="project-links">${playLink}${editLink}</div>
          </div>
        `;

        gallery.appendChild(card);
      });
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function extractColorsFromGameJS(js) {
      // Extract color constants from game.js using regex
      const colors = {
        background: null,
        player: null,
        platform: null,
        accent: null
      };

      // Look for BACKGROUND_COLOR
      const bgMatch = js.match(/BACKGROUND_COLOR\s*=\s*['"]([^'"]+)['"]/);
      if (bgMatch) colors.background = bgMatch[1];

      // Look for PLAYER_COLOR
      const playerMatch = js.match(/PLAYER_COLOR\s*=\s*['"]([^'"]+)['"]/);
      if (playerMatch) colors.player = playerMatch[1];

      // Look for PLATFORM_COLOR or PLATFORM_COLOR_START
      const platformMatch = js.match(/PLATFORM_COLOR(?:_START)?\s*=\s*['"]([^'"]+)['"]/);
      if (platformMatch) colors.platform = platformMatch[1];

      // Look for COIN_COLOR or SCORE_COLOR for accent
      const coinMatch = js.match(/COIN_COLOR\s*=\s*['"]([^'"]+)['"]/);
      const scoreMatch = js.match(/SCORE_COLOR\s*=\s*['"]([^'"]+)['"]/);
      colors.accent = coinMatch ? coinMatch[1] : (scoreMatch ? scoreMatch[1] : null);

      return colors;
    }

    async function openProjectInJSFiddle(folderPath) {
      try {
        // Fetch the project files
        const [htmlRes, cssRes, jsRes] = await Promise.all([
          fetch(`${folderPath}/index.html`),
          fetch(`${folderPath}/style.css`),
          fetch(`${folderPath}/game.js`)
        ]);

        const htmlFull = await htmlRes.text();
        const css = await cssRes.text();
        const js = await jsRes.text();

        // Extract colors from game.js
        const colors = extractColorsFromGameJS(js);

        // Log the colors for easy copy-paste into showcase-data.js
        console.log('=== Color Theme Detected ===');
        console.log('Copy this into showcase-data.js:');
        console.log('');
        console.log('preview: {');
        if (colors.background) console.log(`  background: '${colors.background}',`);
        if (colors.player) console.log(`  player: '${colors.player}',`);
        if (colors.platform) console.log(`  platform: '${colors.platform}',`);
        if (colors.accent) console.log(`  accent: '${colors.accent}'`);
        console.log('}');
        console.log('');

        // Extract just the body content from HTML
        const bodyMatch = htmlFull.match(/<body[^>]*>([\s\S]*)<\/body>/i);
        const html = bodyMatch ? bodyMatch[1].replace(/<script[^>]*>.*?<\/script>/gi, '').trim() : htmlFull;

        // Create a form and POST to JSFiddle
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = 'https://jsfiddle.net/api/post/library/pure/';
        form.target = '_blank';

        // Add form fields
        const fields = {
          html: html,
          css: css,
          js: js,
          title: 'Juicy Platformer - Year 8 Coding Session',
          wrap: 'b'
        };

        for (const [key, value] of Object.entries(fields)) {
          const input = document.createElement('input');
          input.type = 'hidden';
          input.name = key;
          input.value = value;
          form.appendChild(input);
        }

        document.body.appendChild(form);
        form.submit();
        document.body.removeChild(form);
      } catch (error) {
        console.error('Error creating JSFiddle:', error);
        alert('Failed to create JSFiddle. Please try again.');
      }
    }

    // Helper function to extract colors from a project folder
    // Usage: extractProjectColors('showcase/06-Willem')
    async function extractProjectColors(folderPath) {
      try {
        const jsRes = await fetch(`${folderPath}/game.js`);
        const js = await jsRes.text();
        const colors = extractColorsFromGameJS(js);

        console.log('=== Color Theme for ' + folderPath + ' ===');
        console.log('Copy this into showcase-data.js:');
        console.log('');
        console.log('preview: {');
        if (colors.background) console.log(`  background: '${colors.background}',`);
        if (colors.player) console.log(`  player: '${colors.player}',`);
        if (colors.platform) console.log(`  platform: '${colors.platform}',`);
        if (colors.accent) console.log(`  accent: '${colors.accent}'`);
        console.log('}');
        console.log('');

        return colors;
      } catch (error) {
        console.error('Error extracting colors:', error);
        return null;
      }
    }

    // Make it available globally for console access
    window.extractProjectColors = extractProjectColors;

    // Load projects when page loads
    loadProjects();
  </script>
</body>
</html>
